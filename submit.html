<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit Music â€” Before The Data</title>
  <meta name="description" content="Submit your music to Before The Data. Chad listens to everything personally.">
  <meta name="author" content="Chad Hillard">
  <link rel="canonical" href="https://beforethedata.com/submit.html">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://beforethedata.com/submit.html">
  <meta property="og:title" content="Submit Music â€” Before The Data">
  <meta property="og:description" content="Chad listens to everything personally.">
  <meta property="og:image" content="https://beforethedata.com/assets/og-image.jpg">
  <meta property="og:site_name" content="Before The Data">
  <link rel="stylesheet" href="css/main.css">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <style>
    /* â”€â”€ Submit Page Styles â”€â”€ */
    .submit-wrap {
      max-width: 560px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }
    .submit-header {
      margin-bottom: 40px;
    }
    .submit-header h1 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 52px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      line-height: 1;
      margin: 0 0 12px;
    }
    .submit-header p {
      font-size: 15px;
      color: #555;
      line-height: 1.6;
      margin: 0;
    }
    /* Steps */
    .step-block {
      display: none;
      animation: fadeIn 0.25s ease;
    }
    .step-block.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* Cards */
    .submit-card {
      border: 1px solid #e0e0e0;
      padding: 32px;
      margin-bottom: 24px;
    }
    .submit-card h2 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 24px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0 0 8px;
    }
    .submit-card p {
      font-size: 14px;
      color: #555;
      line-height: 1.6;
      margin: 0 0 20px;
    }

    /* Form fields */
    .field-group { margin-bottom: 16px; }
    .field-group label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #000;
      margin-bottom: 6px;
    }
    .field-group .req { color: #999; font-weight: 400; }
    .field-input, .field-textarea, .field-select {
      width: 100%;
      padding: 12px 14px;
      border: 1.5px solid #e0e0e0;
      font-family: inherit;
      font-size: 14px;
      background: #fafafa;
      color: #000;
      outline: none;
      transition: border-color 0.15s;
      box-sizing: border-box;
    }
    .field-input:focus, .field-textarea:focus, .field-select:focus {
      border-color: #000;
      background: #fff;
    }
    .field-textarea { resize: vertical; min-height: 100px; }
    .char-count { font-size: 11px; color: #aaa; text-align: right; margin-top: 4px; }
    .char-count.over { color: #c00; }

    /* Buttons */
    .btn-primary {
      display: block;
      width: 100%;
      padding: 14px;
      background: #000;
      color: #fff;
      font-family: inherit;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      transition: background 0.15s;
      text-align: center;
    }
    .btn-primary:hover { background: #222; }
    .btn-primary:disabled { opacity: 0.5; cursor: default; }

    /* Heard First pitch (after email gate) */
    .heard-first-pitch {
      background: #000;
      color: #fff;
      padding: 24px 32px;
      margin-bottom: 24px;
    }
    .heard-first-pitch h3 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 20px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0 0 8px;
    }
    .heard-first-pitch p {
      font-size: 13px;
      color: #ccc;
      line-height: 1.5;
      margin: 0 0 16px;
    }
    .heard-first-pitch a {
      display: inline-block;
      padding: 9px 20px;
      background: #fff;
      color: #000;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      text-decoration: none;
    }
    .heard-first-pitch a:hover { background: #f0f0f0; }

    /* Price badge */
    .price-badge {
      display: inline-block;
      background: #000;
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      padding: 4px 10px;
      margin-bottom: 16px;
    }

    /* Divider */
    .divider { border: none; border-top: 1px solid #e0e0e0; margin: 24px 0; }

    /* Success state */
    .success-card {
      border: 2px solid #000;
      padding: 48px 40px;
      text-align: center;
    }
    .success-card .success-icon { font-size: 48px; margin-bottom: 20px; }
    .success-card h2 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 36px;
      font-weight: 700;
      text-transform: uppercase;
      margin: 0 0 12px;
    }
    .success-card p { font-size: 15px; color: #555; line-height: 1.6; margin: 0; }

    /* Error */
    .form-error {
      background: #fff0f0;
      border: 1px solid #fcc;
      color: #c00;
      padding: 12px 16px;
      font-size: 13px;
      margin-bottom: 16px;
      display: none;
    }
    .form-error.visible { display: block; }

    /* Fine print */
    .fine-print {
      font-size: 12px;
      color: #999;
      line-height: 1.5;
      margin-top: 12px;
    }
    .fine-print a { color: #000; text-decoration: underline; }

    /* Step indicator */
    .step-indicator {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
      align-items: center;
    }
    .step-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #e0e0e0;
      transition: background 0.2s;
    }
    .step-dot.done { background: #000; }
    .step-label {
      font-size: 11px;
      color: #999;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-weight: 600;
    }
    .step-label.current { color: #000; }
  </style>
</head>
<body data-page="submit">
  <div id="player-bar">
    <img class="player-art" src="assets/brand/logo-black.jpg" alt="">
    <div class="player-controls">
      <button class="prev-btn" title="Previous">&#9198;</button>
      <button class="play-btn" title="Play">&#9654;</button>
      <button class="next-btn" title="Next">&#9197;</button>
    </div>
    <div class="player-info">
      <div class="player-title">Select a track to play</div>
      <div class="player-source">SPOTIFY</div>
    </div>
    <div class="player-right">
      <button class="heart-btn" title="Like">&#9825;</button>
      <input type="range" class="volume-slider" min="0" max="1" step="0.05" value="0.8">
    </div>
    <div class="player-progress"><div class="player-progress-fill"></div></div>
  </div>

  <aside id="sidebar">
    <a href="index.html" class="sidebar-brand">
      <img src="assets/brand/logo-black.jpg" alt="BTD">
      <span class="brand-name">Before The Data</span>
    </a>
    <nav>
      <a href="index.html"><span class="nav-icon">â—ˆ</span> Discover</a>
      <a href="new-music.html"><span class="nav-icon">â™ª</span> New Music</a>
      <a href="popular.html"><span class="nav-icon">â–²</span> Popular</a>
      <a href="search.html"><span class="nav-icon">âŒ•</span> Search</a>
      <a href="submit.html" class="active"><span class="nav-icon">ðŸ“¬</span> Submit Music</a>
    </nav>
    <div class="sidebar-footer">
      <a href="about.html">About</a>
      <a href="heard-first.html" style="font-weight:700;">â˜… Heard First</a>
      <a href="contact.html">Contact</a>
    </div>
  </aside>

  <main id="main">
    <div class="submit-wrap">
      <div class="submit-header">
        <h1>Submit Your Music</h1>
        <p>Chad listens to everything personally. Before The Data has been finding artists before anyone else since 2007 â€” Billie Eilish, Lorde, Halsey, LANY, Daniel Caesar. All found here first.</p>
      </div>

      <!-- STEP 1: Email Gate -->
      <div id="step-email" class="step-block active">
        <div class="submit-card">
          <h2>First, your email</h2>
          <p>We'll send you a confirmation and follow-up at this address. No spam, ever.</p>
          <div id="email-error" class="form-error"></div>
          <form id="email-form">
            <div class="field-group">
              <label for="gate-email">Your Email <span class="req">*</span></label>
              <input type="email" id="gate-email" class="field-input" placeholder="artist@example.com" required autocomplete="email">
            </div>
            <button type="submit" class="btn-primary" id="email-submit-btn">Continue â†’</button>
          </form>
        </div>
      </div>

      <!-- STEP 2: Payment -->
      <div id="step-payment" class="step-block">
        <!-- Heard First pitch -->
        <div class="heard-first-pitch">
          <h3>â˜… Heard First â€” A&R Intel, 48 Hours Early</h3>
          <p>Get the artists Chad finds before we publish. Playlist additions, stream milestones, breakout signals â€” delivered to your inbox before the blogs catch on.</p>
          <a href="heard-first.html">Get Heard First â†’</a>
        </div>

        <div class="submit-card">
          <h2>Submit Your Track</h2>
          <span class="price-badge">$5 one-time</span>
          <p>One submission. Chad personally listens. If it fits what we're looking for, you'll hear back.</p>
          <div id="payment-error" class="form-error"></div>
          <button class="btn-primary" id="checkout-btn">Pay $5 &amp; Submit â†’</button>
          <p class="fine-print">Secure payment via Stripe. One-time charge, not a subscription.</p>
        </div>
      </div>

      <!-- STEP 3: Submission Form (after paid=1 in URL) -->
      <div id="step-form" class="step-block">
        <div class="submit-card">
          <h2>Your Track Info</h2>
          <p>Fill this out. The more detail the better. Chad reads every word.</p>
          <div id="submit-error" class="form-error"></div>
          <form id="submit-form">
            <div class="field-group">
              <label for="spotify-url">Spotify Track URL <span class="req">*</span></label>
              <input type="url" id="spotify-url" class="field-input" placeholder="https://open.spotify.com/track/..." required>
            </div>
            <div class="field-group">
              <label for="artist-name">Artist Name <span class="req">*</span></label>
              <input type="text" id="artist-name" class="field-input" placeholder="Your artist name" required>
            </div>
            <div class="field-group">
              <label for="genre">Genre <span class="req">*</span></label>
              <input type="text" id="genre" class="field-input" placeholder="e.g. Alt-R&B, Bedroom Pop, Indie Electronic" required>
            </div>
            <hr class="divider">
            <div class="field-group">
              <label for="instagram-url">Instagram URL</label>
              <input type="url" id="instagram-url" class="field-input" placeholder="https://instagram.com/yourhandle">
            </div>
            <div class="field-group">
              <label for="tiktok-url">TikTok URL</label>
              <input type="url" id="tiktok-url" class="field-input" placeholder="https://tiktok.com/@yourhandle">
            </div>
            <div class="field-group">
              <label for="bio">Short Bio <span class="req">(max 300 chars)</span></label>
              <textarea id="bio" class="field-textarea" placeholder="Who you are, where you're from, what this track is about..." maxlength="300"></textarea>
              <div class="char-count"><span id="bio-count">0</span>/300</div>
            </div>
            <button type="submit" class="btn-primary" id="submit-btn">Send It In â†’</button>
            <p class="fine-print">By submitting you confirm this is your original work.</p>
          </form>
        </div>
      </div>

      <!-- SUCCESS STATE -->
      <div id="step-success" class="step-block">
        <div class="success-card">
          <div class="success-icon">ðŸ“¬</div>
          <h2>We Got It.</h2>
          <p>Your track is in the queue. Chad listens to everything personally. You'll hear back.<br><br>Check your inbox for a confirmation.</p>
        </div>
      </div>
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/player.js"></script>
  <script>
    /* â”€â”€ Submit Music Page Logic â”€â”€ */
    const FIREBASE_KEY = 'AIzaSyAI2Nrt4PsnOB0DyLa4yrWYyY39Oblzcec';
    const FIREBASE_BASE = 'https://firestore.googleapis.com/v1/projects/ar-scouting-dashboard/databases/(default)/documents';

    const params = new URLSearchParams(window.location.search);
    const paid = params.get('paid') === '1';
    const sessionId = params.get('session_id') || '';

    let capturedEmail = '';

    // Try to restore email from storage
    try { capturedEmail = localStorage.getItem('btd_submit_email') || ''; } catch(e) {}

    function showStep(id) {
      document.querySelectorAll('.step-block').forEach(el => el.classList.remove('active'));
      const el = document.getElementById(id);
      if (el) el.classList.add('active');
    }

    // If already paid, skip to form
    if (paid) {
      showStep('step-form');
    } else if (capturedEmail) {
      showStep('step-payment');
    }

    // Email form
    const emailForm = document.getElementById('email-form');
    const emailError = document.getElementById('email-error');
    const emailSubmitBtn = document.getElementById('email-submit-btn');

    emailForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('gate-email').value.trim();
      if (!email) return;

      emailSubmitBtn.textContent = 'Saving...';
      emailSubmitBtn.disabled = true;
      emailError.classList.remove('visible');

      try {
        const id = email.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        await fetch(`${FIREBASE_BASE}/config/btd_sub_${id}?key=${FIREBASE_KEY}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fields: {
            email: { stringValue: email },
            subscribedAt: { stringValue: new Date().toISOString() },
            source: { stringValue: 'submit-gate' },
            tier: { stringValue: 'free' }
          }})
        });
        capturedEmail = email;
        try { localStorage.setItem('btd_submit_email', email); } catch(e) {}
        showStep('step-payment');
      } catch(err) {
        emailError.textContent = 'Something went wrong. Please try again.';
        emailError.classList.add('visible');
        emailSubmitBtn.textContent = 'Continue â†’';
        emailSubmitBtn.disabled = false;
      }
    });

    // Checkout button
    const checkoutBtn = document.getElementById('checkout-btn');
    const paymentError = document.getElementById('payment-error');

    checkoutBtn.addEventListener('click', async () => {
      checkoutBtn.textContent = 'Loading checkout...';
      checkoutBtn.disabled = true;
      paymentError.classList.remove('visible');

      try {
        const res = await fetch('/api/create-submit-checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: capturedEmail })
        });
        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error(data.error || 'No checkout URL returned');
        }
      } catch(err) {
        paymentError.textContent = 'Payment failed to load. Please try again.';
        paymentError.classList.add('visible');
        checkoutBtn.textContent = 'Pay $5 & Submit â†’';
        checkoutBtn.disabled = false;
      }
    });

    // Bio char counter
    const bioField = document.getElementById('bio');
    const bioCount = document.getElementById('bio-count');
    bioField.addEventListener('input', () => {
      const len = bioField.value.length;
      bioCount.textContent = len;
      bioCount.parentElement.classList.toggle('over', len > 300);
    });

    // Submission form
    const submitForm = document.getElementById('submit-form');
    const submitError = document.getElementById('submit-error');
    const submitBtn = document.getElementById('submit-btn');

    submitForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      submitBtn.textContent = 'Sending...';
      submitBtn.disabled = true;
      submitError.classList.remove('visible');

      const email = capturedEmail || '';
      const spotifyUrl = document.getElementById('spotify-url').value.trim();
      const artistName = document.getElementById('artist-name').value.trim();
      const genre = document.getElementById('genre').value.trim();
      const instagramUrl = document.getElementById('instagram-url').value.trim();
      const tiktokUrl = document.getElementById('tiktok-url').value.trim();
      const bio = document.getElementById('bio').value.trim();

      try {
        const res = await fetch('/api/submit-music', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email, spotifyUrl, artistName, genre,
            instagramUrl, tiktokUrl, bio,
            stripeSessionId: sessionId
          })
        });
        if (!res.ok) {
          const d = await res.json().catch(() => ({}));
          throw new Error(d.error || 'Submission failed');
        }
        // Clear stored email
        try { localStorage.removeItem('btd_submit_email'); } catch(e) {}
        showStep('step-success');
      } catch(err) {
        submitError.textContent = 'Something went wrong. Please try again or email hello@beforethedata.com';
        submitError.classList.add('visible');
        submitBtn.textContent = 'Send It In â†’';
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
